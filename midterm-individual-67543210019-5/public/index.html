<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏°‡∏∏‡∏î</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>üìö ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏°‡∏∏‡∏î</h1>

        <!-- ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ -->
        <section id="statistics">
            <h2>‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</h2>
            <p>‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: <span id="total">0</span> ‡πÄ‡∏•‡πà‡∏°</p>
            <p>‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏°: <span id="available">0</span> ‡πÄ‡∏•‡πà‡∏°</p>
            <p>‡∏ñ‡∏π‡∏Å‡∏¢‡∏∑‡∏°‡πÅ‡∏•‡πâ‡∏ß: <span id="borrowed">0</span> ‡πÄ‡∏•‡πà‡∏°</p>
        </section>

        <!-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ -->
        <section id="add-book-section">
            <h2>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÉ‡∏´‡∏°‡πà</h2>
            <form id="add-book-form">
                <input type="text" id="title" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠" required>
                <input type="text" id="author" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á" required>
                <input type="text" id="isbn" placeholder="‡∏£‡∏´‡∏±‡∏™ ISBN" required>
                <button type="submit">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</button>
            </form>
            <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏° -->
            <p id="added-message" style="text-align:center; color:#1b5e20; font-weight:bold;"></p>
        </section>

        <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ -->
        <section id="book-list-section">
            <h2>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</h2>
            <ul id="book-list"></ul>
        </section>

    </div>

    <script>
        const bookList = document.getElementById('book-list');
        const addBookForm = document.getElementById('add-book-form');
        const totalSpan = document.getElementById('total');
        const availableSpan = document.getElementById('available');
        const borrowedSpan = document.getElementById('borrowed');
        const addedMessage = document.getElementById('added-message');

        async function fetchBooks() {
            try {
                const res = await fetch('/api/books');
                if (!res.ok) throw new Error("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÑ‡∏î‡πâ");
                const books = await res.json();
                renderBooks(books);
                updateStats(books);
            } catch (err) {
                console.error(err);
                addedMessage.textContent = "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‚ùå";
            }
        }

        function renderBooks(books) {
            bookList.innerHTML = '';
            books.forEach(book => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <span>${book.title} ‡πÇ‡∏î‡∏¢ ${book.author} (ISBN: ${book.isbn})</span>
                    <div>
                        <button onclick="toggleBorrowed(${book.id}, ${book.borrowed})">
                            ${book.borrowed ? '‡∏Ñ‡∏∑‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠' : '‡∏¢‡∏∑‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠'}
                        </button>
                        <button onclick="deleteBook(${book.id})">‡∏•‡∏ö</button>
                    </div>
                `;
                bookList.appendChild(li);
            });
        }

        function updateStats(books) {
            totalSpan.textContent = books.length;
            availableSpan.textContent = books.filter(b => !b.borrowed).length;
            borrowedSpan.textContent = books.filter(b => b.borrowed).length;
        }

        addBookForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const book = {
                title: document.getElementById('title').value,
                author: document.getElementById('author').value,
                isbn: document.getElementById('isbn').value,
            };

            try {
                const res = await fetch('/api/books', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(book)
                });

                if (res.ok) {
                    const addedBook = await res.json();
                    addedMessage.textContent = `‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢: ${addedBook.title} / ${addedBook.author} / ISBN: ${addedBook.isbn}`;
                    addBookForm.reset();
                    fetchBooks();
                } else {
                    addedMessage.textContent = "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ ‚ùå";
                }
            } catch (err) {
                console.error(err);
                addedMessage.textContent = "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ backend ‚ùå";
            }
        });

        async function deleteBook(id) {
            try {
                const res = await fetch(`/api/books/${id}`, { method: 'DELETE' });
                if (!res.ok) throw new Error("‡∏•‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
                addedMessage.textContent = "‡∏•‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß ‚úÖ";
                fetchBooks();
            } catch (err) {
                console.error(err);
                addedMessage.textContent = "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ ‚ùå";
            }
        }

        async function toggleBorrowed(id, borrowed) {
            try {
                const res = await fetch(`/api/books/${id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ borrowed: !borrowed })
                });
                if (!res.ok) throw new Error("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÑ‡∏î‡πâ");
                addedMessage.textContent = !borrowed ? "‡∏¢‡∏∑‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‚úÖ" : "‡∏Ñ‡∏∑‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‚úÖ";
                fetchBooks();
            } catch (err) {
                console.error(err);
                addedMessage.textContent = "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ ‚ùå";
            }
        }

        fetchBooks();
    </script>
</body>
</html>
